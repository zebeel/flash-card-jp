<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ—¥æœ¬èªãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --ink: #1a1a1a;
    --paper: #f5f0e8;
    --washi: #ede8dd;
    --vermillion: #c0392b;
    --gold: #c9a84c;
    --sky: #5b8fb9;
    --sage: #6b8f71;
    --shadow: rgba(0,0,0,0.12);
    --radius: 20px;
    --trans: cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  html, body {
    height: 100%;
    overflow: hidden;
    background: var(--paper);
    color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif;
    -webkit-font-smoothing: antialiased;
  }

  /* â”€â”€â”€ APP SHELL â”€â”€â”€ */
  #app {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  /* â”€â”€â”€ PAGE TRANSITIONS â”€â”€â”€ */
  .page {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    transition: transform 0.5s cubic-bezier(0.77,0,0.175,1), opacity 0.5s ease;
  }
  .page.hidden {
    transform: translateX(100%);
    opacity: 0;
    pointer-events: none;
  }
  .page.slide-out {
    transform: translateX(-100%);
    opacity: 0;
  }

  /* â”€â”€â”€ BACKGROUND TEXTURE â”€â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Ccircle cx='30' cy='30' r='0.8' fill='%23c9a84c' opacity='0.15'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOMEPAGE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #home-page {
    padding: 0;
    background: var(--paper);
  }

  .home-header {
    padding: 56px 32px 24px;
    position: relative;
    z-index: 1;
  }

  .home-header .jp-title {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.3em;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .home-header h1 {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 38px;
    font-weight: 900;
    line-height: 1.1;
    color: var(--ink);
    letter-spacing: -0.02em;
  }

  .home-header h1 span {
    display: block;
    color: var(--vermillion);
  }

  /* Red stripe decoration */
  .stripe-decor {
    width: 48px;
    height: 4px;
    background: var(--vermillion);
    border-radius: 2px;
    margin: 16px 0 8px 32px;
  }

  /* Scrollable settings area */
  .home-body {
    flex: 1;
    overflow-y: auto;
    padding: 8px 24px 32px;
    position: relative;
    z-index: 1;
    -webkit-overflow-scrolling: touch;
  }

  /* â”€â”€â”€ SETTING CARDS â”€â”€â”€ */
  .setting-card {
    background: #fff;
    border-radius: var(--radius);
    padding: 20px 22px;
    margin-bottom: 14px;
    box-shadow: 0 2px 12px var(--shadow);
    border: 1px solid rgba(201,168,76,0.15);
  }

  .setting-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .setting-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(201,168,76,0.25);
  }

  /* Script toggle */
  .script-toggle {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .script-btn {
    padding: 14px 8px;
    border: 2px solid transparent;
    border-radius: 12px;
    background: var(--washi);
    cursor: pointer;
    text-align: center;
    transition: all 0.25s var(--trans);
    position: relative;
    overflow: hidden;
  }

  .script-btn .jp {
    display: block;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 26px;
    font-weight: 900;
    color: var(--ink);
    line-height: 1.2;
    transition: color 0.2s;
  }

  .script-btn .en {
    display: block;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #999;
    margin-top: 2px;
    transition: color 0.2s;
  }

  .script-btn.active {
    border-color: var(--vermillion);
    background: #fff5f4;
  }

  .script-btn.active .jp { color: var(--vermillion); }
  .script-btn.active .en { color: var(--vermillion); }

  .script-btn:hover:not(.active) {
    border-color: rgba(201,168,76,0.4);
    transform: translateY(-1px);
  }

  /* Topic cards */
  .topic-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .topic-btn {
    padding: 16px 10px;
    border: 2px solid transparent;
    border-radius: 14px;
    background: var(--washi);
    cursor: pointer;
    text-align: center;
    transition: all 0.25s var(--trans);
  }

  .topic-btn .icon {
    font-size: 32px;
    line-height: 1;
    margin-bottom: 6px;
    display: block;
  }

  .topic-btn .jp-name {
    display: block;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--ink);
  }

  .topic-btn .count {
    display: block;
    font-size: 10px;
    letter-spacing: 0.1em;
    color: #aaa;
    margin-top: 2px;
    font-family: 'Space Mono', monospace;
  }

  .topic-btn.active {
    border-color: var(--sky);
    background: #f0f6fc;
  }

  .topic-btn.active .jp-name { color: var(--sky); }
  .topic-btn:hover:not(.active) {
    border-color: rgba(91,143,185,0.3);
    transform: translateY(-1px);
  }

  /* Auto-speak toggle */
  .auto-speak-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .auto-speak-info .title {
    font-size: 16px;
    font-weight: 700;
    color: var(--ink);
  }

  .auto-speak-info .desc {
    font-size: 12px;
    color: #999;
    margin-top: 2px;
    line-height: 1.4;
  }

  /* iOS-style toggle */
  .toggle {
    width: 52px;
    height: 30px;
    position: relative;
    cursor: pointer;
    flex-shrink: 0;
  }

  .toggle input { display: none; }

  .toggle-track {
    width: 100%;
    height: 100%;
    background: #ddd;
    border-radius: 15px;
    transition: background 0.25s ease;
    position: relative;
  }

  .toggle-thumb {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 24px;
    height: 24px;
    background: white;
    border-radius: 50%;
    transition: transform 0.25s var(--trans);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  }

  .toggle input:checked ~ .toggle-track {
    background: var(--sage);
  }

  .toggle input:checked ~ .toggle-track .toggle-thumb {
    transform: translateX(22px);
  }

  /* Start button */
  .start-btn {
    width: 100%;
    padding: 18px;
    border: none;
    border-radius: var(--radius);
    background: var(--vermillion);
    color: white;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 17px;
    font-weight: 700;
    letter-spacing: 0.08em;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.2s ease;
    margin-top: 6px;
    box-shadow: 0 6px 20px rgba(192,57,43,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .start-btn:hover {
    background: #a93226;
    transform: translateY(-2px);
    box-shadow: 0 10px 28px rgba(192,57,43,0.45);
  }

  .start-btn:active {
    transform: translateY(0);
    box-shadow: 0 4px 12px rgba(192,57,43,0.35);
  }

  .start-btn .arrow {
    font-size: 20px;
    transition: transform 0.2s ease;
  }

  .start-btn:hover .arrow {
    transform: translateX(4px);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FLASHCARD PAGE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #flash-page {
    background: var(--paper);
  }

  /* Top bar */
  .flash-topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 52px 20px 12px;
    position: relative;
    z-index: 10;
  }

  .back-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 2px 10px var(--shadow);
    transition: all 0.2s ease;
  }

  .back-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 16px var(--shadow);
  }

  .progress-info {
    text-align: center;
  }

  .progress-text {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    color: var(--ink);
    font-weight: 700;
  }

  .progress-sub {
    font-size: 10px;
    color: #bbb;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 1px;
  }

  .shuffle-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    box-shadow: 0 2px 10px var(--shadow);
    transition: all 0.3s ease;
  }

  .shuffle-btn:hover {
    transform: rotate(180deg);
    box-shadow: 0 4px 16px var(--shadow);
  }

  /* Progress bar */
  .progress-bar-wrap {
    height: 3px;
    background: rgba(0,0,0,0.08);
    margin: 0 24px;
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--vermillion);
    border-radius: 2px;
    transition: width 0.4s ease;
  }

  /* Card area */
  .card-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  /* Swipe hint */
  .swipe-hint {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 12px;
    opacity: 0.4;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    white-space: nowrap;
    pointer-events: none;
    transition: opacity 0.5s ease;
  }

  .swipe-hint.faded { opacity: 0; }

  .swipe-hint .dot {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: var(--ink);
  }

  /* â”€â”€â”€ FLASHCARD â”€â”€â”€ */
  .card-scene {
    width: 100%;
    max-width: 340px;
    aspect-ratio: 3/4;
    perspective: 1200px;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
  }

  .card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.55s cubic-bezier(0.4,0,0.2,1);
  }

  .card-inner.flipped {
    transform: rotateY(180deg);
  }

  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 24px;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    overflow: hidden;
    box-shadow: 
      0 4px 20px rgba(0,0,0,0.1),
      0 12px 40px rgba(0,0,0,0.08);
  }

  /* Front face â€” image */
  .card-front {
    background: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0;
  }

  .card-image-wrap {
    flex: 1;
    width: 100%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .card-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: opacity 0.3s ease;
  }

  .card-img-fallback {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 80px;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .card-img.loading {
    opacity: 0;
  }

  .card-img.error {
    opacity: 0;
  }

  .card-img.error ~ .card-img-fallback {
    opacity: 1;
  }

  .card-front-label {
    width: 100%;
    flex-shrink: 0;
    padding: 16px 20px 20px;
    text-align: center;
    border-top: 1px solid rgba(0,0,0,0.06);
    background: white;
  }

  .card-front-label .romaji {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--ink);
    letter-spacing: 0.08em;
    white-space: nowrap;
    overflow: visible;
  }

  .tap-hint {
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(0,0,0,0.06);
    border-radius: 20px;
    padding: 4px 10px;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
  }

  /* Back face â€” kana */
  .card-back {
    background: var(--ink);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transform: rotateY(180deg);
    position: relative;
  }

  /* Back decorative pattern */
  .card-back::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30'%3E%3Ccircle cx='15' cy='15' r='1' fill='%23ffffff' opacity='0.04'/%3E%3C/svg%3E");
  }

  .card-back-content {
    flex: 1;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1;
  }

  .kana-display {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 88px;
    font-weight: 900;
    color: white;
    line-height: 1;
    letter-spacing: 0.05em;
    text-shadow: 0 4px 20px rgba(0,0,0,0.3);
    white-space: nowrap;
    width: 100%;
    text-align: center;
    padding: 0 16px;
  }

  @keyframes kanaReveal {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .card-back-footer {
    width: 100%;
    flex-shrink: 0;
    padding: 16px 20px 20px;
    text-align: center;
    border-top: 1px solid rgba(255,255,255,0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1;
  }

  .kana-romaji {
    font-family: 'Space Mono', monospace;
    font-size: 14px;
    color: rgba(255,255,255,0.35);
    letter-spacing: 0.2em;
    text-transform: lowercase;
  }

  /* Sound button on back */
  .sound-btn {
    position: absolute;
    right: 20px;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    background: rgba(255,255,255,0.12);
    color: white;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
  }

  .sound-btn:hover {
    background: rgba(255,255,255,0.22);
    transform: scale(1.1);
  }

  .sound-btn.playing {
    background: var(--gold);
    animation: pulse 0.6s ease;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }

  /* Script badge on back */
  .script-badge {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 4px 10px;
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.5);
    z-index: 1;
  }

  /* Card transition animation */
  @keyframes cardSlideIn {
    from { opacity: 0; transform: translateX(60px) scale(0.95); }
    to { opacity: 1; transform: translateX(0) scale(1); }
  }

  @keyframes cardSlideInLeft {
    from { opacity: 0; transform: translateX(-60px) scale(0.95); }
    to { opacity: 1; transform: translateX(0) scale(1); }
  }

  @keyframes floatIn {
    from { opacity: 0; transform: scale(0.85) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .card-scene.anim-right .card-inner {
    animation: cardSlideIn 0.4s var(--trans) both;
  }

  .card-scene.anim-left .card-inner {
    animation: cardSlideInLeft 0.4s var(--trans) both;
  }

  /* Swipe gesture trail */
  .card-scene.dragging .card-inner {
    transition: none;
  }

  /* â”€â”€â”€ Completed screen â”€â”€â”€ */
  .complete-screen {
    position: absolute;
    inset: 0;
    background: var(--paper);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    text-align: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 20;
  }

  .complete-screen.visible {
    opacity: 1;
    pointer-events: all;
  }

  .complete-kanji {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 72px;
    font-weight: 900;
    color: var(--vermillion);
    line-height: 1;
    margin-bottom: 16px;
  }

  .complete-title {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 26px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 8px;
  }

  .complete-sub {
    font-size: 14px;
    color: #aaa;
    letter-spacing: 0.08em;
    margin-bottom: 40px;
  }

  .complete-btn {
    padding: 16px 40px;
    border: none;
    border-radius: var(--radius);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 6px;
  }

  .complete-btn-primary {
    background: var(--vermillion);
    color: white;
    box-shadow: 0 4px 16px rgba(192,57,43,0.4);
  }

  .complete-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(192,57,43,0.45);
  }

  .complete-btn-secondary {
    background: white;
    color: var(--ink);
    box-shadow: 0 2px 10px var(--shadow);
  }

  /* â”€â”€â”€ Auto-speak indicator â”€â”€â”€ */
  .autospeak-indicator {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--sage);
    color: white;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 12px;
    letter-spacing: 0.1em;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 100;
    white-space: nowrap;
  }

  .autospeak-indicator.show {
    opacity: 1;
  }

  /* â”€â”€â”€ Responsive â”€â”€â”€ */
  @media (max-width: 360px) {
    .kana-display { font-size: 72px; }
    .card-emoji { font-size: 88px; }
  }

  @media (min-height: 800px) {
    .card-scene {
      max-width: 380px;
    }
  }
</style>
</head>
<body>
<div id="app">

  <!-- â•â•â•â•â•â• HOME PAGE â•â•â•â•â•â• -->
  <div id="home-page" class="page">
    <div class="home-header">
      <div class="jp-title">æ—¥æœ¬èª Â· Japanese</div>
      <h1>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥<span>ã‚«ãƒ¼ãƒ‰</span></h1>
    </div>
    <div class="stripe-decor"></div>

    <div class="home-body">
      <!-- Script selection -->
      <div class="setting-card">
        <div class="setting-label">æ–‡å­— Â· Script</div>
        <div class="script-toggle">
          <button class="script-btn active" data-script="hiragana">
            <span class="jp">ã‚</span>
            <span class="en">Hiragana</span>
          </button>
          <button class="script-btn" data-script="katakana">
            <span class="jp">ã‚¢</span>
            <span class="en">Katakana</span>
          </button>
        </div>
      </div>

      <!-- Topic selection -->
      <div class="setting-card">
        <div class="setting-label">ãƒ†ãƒ¼ãƒ Â· Topic</div>
        <div class="topic-grid">
          <button class="topic-btn active" data-topic="shinkansen">
            <span class="icon">ğŸš„</span>
            <span class="jp-name">æ–°å¹¹ç·š</span>
            <span class="count">7 cards</span>
          </button>
          <button class="topic-btn" data-topic="animals">
            <span class="icon">ğŸ¾</span>
            <span class="jp-name">å‹•ç‰©</span>
            <span class="count">8 cards</span>
          </button>
        </div>
      </div>

      <!-- Auto speak -->
      <div class="setting-card">
        <div class="setting-label">è‡ªå‹•èª­ã¿ Â· Auto Speak</div>
        <div class="auto-speak-row">
          <div class="auto-speak-info">
            <div class="title">è‡ªå‹•ç™ºéŸ³</div>
            <div class="desc">ã‚«ãƒ¼ãƒ‰ã‚’è£è¿”ã™ã¨<br>è‡ªå‹•ã§èª­ã¿ä¸Šã’ã¾ã™</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="auto-speak-toggle">
            <div class="toggle-track">
              <div class="toggle-thumb"></div>
            </div>
          </label>
        </div>
      </div>

      <!-- Start button -->
      <button class="start-btn" id="start-btn">
        ã¯ã˜ã‚ã‚‹ Â· Start
        <span class="arrow">â†’</span>
      </button>
    </div>
  </div>

  <!-- â•â•â•â•â•â• FLASHCARD PAGE â•â•â•â•â•â• -->
  <div id="flash-page" class="page hidden">
    <!-- Top bar -->
    <div class="flash-topbar">
      <button class="back-btn" id="back-btn">â†</button>
      <div class="progress-info">
        <div class="progress-text" id="progress-text">1 / 7</div>
        <div class="progress-sub">ã‚«ãƒ¼ãƒ‰</div>
      </div>
      <button class="shuffle-btn" id="shuffle-btn" title="Shuffle">â‡Œ</button>
    </div>

    <!-- Progress bar -->
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progress-bar" style="width:0%"></div>
    </div>

    <!-- Card area -->
    <div class="card-area" id="card-area">
      <div class="card-scene" id="card-scene">
        <div class="card-inner" id="card-inner">
          <!-- Front -->
          <div class="card-face card-front" id="card-front">
            <div class="card-image-wrap" id="card-image-wrap">
              <img class="card-img" id="card-img" src="" alt="" />
              <div class="card-img-fallback" id="card-img-fallback"></div>
            </div>
            <div class="card-front-label">
              <div class="romaji" id="card-romaji">nozomi</div>
            </div>
            <div class="tap-hint">TAP</div>
          </div>
          <!-- Back -->
          <div class="card-face card-back" id="card-back">
            <div class="card-back-content">
              <div class="kana-display" id="kana-display">ã®ãã¿</div>
            </div>
            <div class="card-back-footer">
              <div class="kana-romaji" id="kana-romaji-back">nozomi</div>
              <button class="sound-btn" id="sound-btn">ğŸ”Š</button>
            </div>
          </div>
        </div>
      </div>

      <div class="swipe-hint" id="swipe-hint">
        <span>â† prev</span>
        <span class="dot"></span>
        <span>swipe</span>
        <span class="dot"></span>
        <span>next â†’</span>
      </div>
    </div>

    <!-- Complete screen -->
    <div class="complete-screen" id="complete-screen">
      <div class="complete-kanji">å®Œäº†</div>
      <div class="complete-title">ã‚ˆãã§ãã¾ã—ãŸï¼</div>
      <div class="complete-sub">Well done! You've reviewed all cards.</div>
      <button class="complete-btn complete-btn-primary" id="restart-btn">
        ã‚‚ã†ä¸€åº¦ Â· Play Again
      </button>
      <button class="complete-btn complete-btn-secondary" id="home-from-complete-btn">
        ãƒ›ãƒ¼ãƒ  Â· Home
      </button>
    </div>
  </div>

  <!-- Auto speak toast -->
  <div class="autospeak-indicator" id="autospeak-indicator">ğŸ”Š è‡ªå‹•èª­ã¿</div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DATA = {
  version: "1.0",
  topics: [
    { id: "shinkansen", name: "æ–°å¹¹ç·š", emoji: "ğŸš„" },
    { id: "animals",    name: "å‹•ç‰©",   emoji: "ğŸ¾" }
  ],
  cards: [
    // æ–°å¹¹ç·šï¼ˆTokaido / Sanyo / Kyushuï¼‰
    {
      id: "nozomi",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/nozomi.jpg",
      kana: { hiragana: "ã®ãã¿", katakana: "ãƒã‚¾ãƒŸ" },
      romaji: "nozomi",
    },
    {
      id: "mizuho",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/mizuho.jpg",
      kana: { hiragana: "ã¿ãšã»", katakana: "ãƒŸã‚ºãƒ›" },
      romaji: "mizuho",
    },
    {
      id: "hikari",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/hikari.jpg",
      kana: { hiragana: "ã²ã‹ã‚Š", katakana: "ãƒ’ã‚«ãƒª" },
      romaji: "hikari",
    },
    {
      id: "sakura",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/sakura.jpg",
      kana: { hiragana: "ã•ãã‚‰", katakana: "ã‚µã‚¯ãƒ©" },
      romaji: "sakura",
    },
    {
      id: "kodama",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/kodama.jpg",
      kana: { hiragana: "ã“ã ã¾", katakana: "ã‚³ãƒ€ãƒ" },
      romaji: "kodama",
    },
    {
      id: "tsubame",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/tsubame.jpg",
      kana: { hiragana: "ã¤ã°ã‚", katakana: "ãƒ„ãƒãƒ¡" },
      romaji: "tsubame",
    },

    // æ–°å¹¹ç·šï¼ˆTohoku / Hokkaido / Akita / Yamagataï¼‰
    {
      id: "hayabusa",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/hayabusa.jpg",
      kana: { hiragana: "ã¯ã‚„ã¶ã•", katakana: "ãƒãƒ¤ãƒ–ã‚µ" },
      romaji: "hayabusa",
    },
    {
      id: "hayate",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/hayate.jpg",
      kana: { hiragana: "ã¯ã‚„ã¦", katakana: "ãƒãƒ¤ãƒ†" },
      romaji: "hayate",
    },
    {
      id: "yamabiko",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/yamabiko.jpg",
      kana: { hiragana: "ã‚„ã¾ã³ã“", katakana: "ãƒ¤ãƒãƒ“ã‚³" },
      romaji: "yamabiko",
    },
    {
      id: "nasuno",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/nasuno.jpg",
      kana: { hiragana: "ãªã™ã®", katakana: "ãƒŠã‚¹ãƒ" },
      romaji: "nasuno",
    },
    {
      id: "komachi",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/komachi.jpg",
      kana: { hiragana: "ã“ã¾ã¡", katakana: "ã‚³ãƒãƒ" },
      romaji: "komachi",
    },
    {
      id: "tsubasa",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/tsubasa.jpg",
      kana: { hiragana: "ã¤ã°ã•", katakana: "ãƒ„ãƒã‚µ" },
      romaji: "tsubasa",
    },

    // æ–°å¹¹ç·šï¼ˆJoetsuï¼‰
    {
      id: "toki",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/toki.jpg",
      kana: { hiragana: "ã¨ã", katakana: "ãƒˆã‚­" },
      romaji: "toki",
    },
    {
      id: "tanigawa",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/tanigawa.jpg",
      kana: { hiragana: "ãŸã«ãŒã‚", katakana: "ã‚¿ãƒ‹ã‚¬ãƒ¯" },
      romaji: "tanigawa",
    },

    // æ–°å¹¹ç·šï¼ˆHokurikuï¼‰
    {
      id: "kagayaki",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/kagayaki.jpg",
      kana: { hiragana: "ã‹ãŒã‚„ã", katakana: "ã‚«ã‚¬ãƒ¤ã‚­" },
      romaji: "kagayaki",
    },
    {
      id: "hakutaka",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/hakutaka.jpg",
      kana: { hiragana: "ã¯ããŸã‹", katakana: "ãƒã‚¯ã‚¿ã‚«" },
      romaji: "hakutaka",
    },
    {
      id: "asama",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/asama.jpg",
      kana: { hiragana: "ã‚ã•ã¾", katakana: "ã‚¢ã‚µãƒ" },
      romaji: "asama",
    },
    {
      id: "tsurugi",
      topicId: "shinkansen",
      image: "./asset/images/shinkansen/tsurugi.jpg",
      kana: { hiragana: "ã¤ã‚‹ã", katakana: "ãƒ„ãƒ«ã‚®" },
      romaji: "tsurugi",
    },
    // JR é›»è»Š
    {
      id: "yamanote",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Yamanote-Line-E235.jpg",
      kana: { hiragana: "ã‚„ã¾ã®ã¦ã›ã‚“", katakana: "ãƒ¤ãƒãƒãƒ†ã‚»ãƒ³" },
      romaji: "yamanote sen",
    },
    {
      id: "chuo_rapid",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/JRE_Chuo-Rapid-Line_Series-E233-0.jpg",
      kana: { hiragana: "ã¡ã‚…ã†ãŠã†ã‹ã„ããã›ã‚“", katakana: "ãƒãƒ¥ã‚¦ã‚ªã‚¦ã‚«ã‚¤ã‚½ã‚¯ã‚»ãƒ³" },
      romaji: "chuo rapid line",
    },
    {
      id: "keihin_tohoku",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Series-E233-1000-113.jpg",
      kana: { hiragana: "ã‘ã„ã²ã‚“ã¨ã†ã»ãã›ã‚“", katakana: "ã‚±ã‚¤ãƒ’ãƒ³ãƒˆã‚¦ãƒ›ã‚¯ã‚»ãƒ³" },
      romaji: "keihin-tohoku sen",
    },
    {
      id: "saikyo",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Saikyo-Line_E233-7000_127F.jpg",
      kana: { hiragana: "ã•ã„ãã‚‡ã†ã›ã‚“", katakana: "ã‚µã‚¤ã‚­ãƒ§ã‚¦ã‚»ãƒ³" },
      romaji: "saikyo sen",
    },

    // æ±äº¬ãƒ¡ãƒˆãƒ­ åœ°ä¸‹é‰„
    {
      id: "ginza",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Tokyo_Metro_1000_ginza_line.JPG",
      kana: { hiragana: "ãã‚“ã–ã›ã‚“", katakana: "ã‚®ãƒ³ã‚¶ã‚»ãƒ³" },
      romaji: "ginza sen",
    },
    {
      id: "marunouchi",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Tokyo-Metro_Series2000-2026.jpg",
      kana: { hiragana: "ã¾ã‚‹ã®ã†ã¡ã›ã‚“", katakana: "ãƒãƒ«ãƒã‚¦ãƒã‚»ãƒ³" },
      romaji: "marunouchi sen",
    },
    {
      id: "hanzomon",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Tokyo-Metro_Series8000-8015.jpg",
      kana: { hiragana: "ã¯ã‚“ãã†ã‚‚ã‚“ã›ã‚“", katakana: "ãƒãƒ³ã‚¾ã‚¦ãƒ¢ãƒ³ã‚»ãƒ³" },
      romaji: "hanzomon sen",
    },
    {
      id: "tozai",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Tokyo-Metro_Series15000-15001.jpg",
      kana: { hiragana: "ã¨ã†ã–ã„ã›ã‚“", katakana: "ãƒˆã‚¦ã‚¶ã‚¤ã‚»ãƒ³" },
      romaji: "tozai sen",
    },
    {
      id: "fukutoshin",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Tokyo-Metro-Series17000_17005.jpg",
      kana: { hiragana: "ãµãã¨ã—ã‚“ã›ã‚“", katakana: "ãƒ•ã‚¯ãƒˆã‚·ãƒ³ã‚»ãƒ³" },
      romaji: "fukutoshin sen",
    },

    // éƒ½å–¶åœ°ä¸‹é‰„
    {
      id: "oedo",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Toei-subway12-600.jpg",
      kana: { hiragana: "ãŠãŠãˆã©ã›ã‚“", katakana: "ã‚ªã‚ªã‚¨ãƒ‰ã‚»ãƒ³" },
      romaji: "oedo sen",
    },

    // å¤§é˜ªãƒ¡ãƒˆãƒ­
    {
      id: "midosuji",
      topicId: "shinkansen",
      image: "https://commons.wikimedia.org/wiki/Special:FilePath/Osaka-Metro_Series30000.jpg",
      kana: { hiragana: "ã¿ã©ã†ã™ã˜ã›ã‚“", katakana: "ãƒŸãƒ‰ã‚¦ã‚¹ã‚¸ã‚»ãƒ³" },
      romaji: "midosuji sen",
    },
    // å‹•ç‰©
    { id:"lion", title:"Lion", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Lion_waiting_in_Namibia.jpg/500px-Lion_waiting_in_Namibia.jpg",
      kana:{hiragana:"ã‚‰ã„ãŠã‚“",katakana:"ãƒ©ã‚¤ã‚ªãƒ³"}, romaji:"raion", emoji:"ğŸ¦"},

    { id:"tiger", title:"Tiger", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Walking_tiger_female.jpg/500px-Walking_tiger_female.jpg",
      kana:{hiragana:"ã¨ã‚‰",katakana:"ãƒˆãƒ©"}, romaji:"tora", emoji:"ğŸ¯"},

    { id:"elephant", title:"African bush elephant", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/African_Bush_Elephant.jpg/500px-African_Bush_Elephant.jpg",
      kana:{hiragana:"ãã†",katakana:"ã‚¾ã‚¦"}, romaji:"zou", emoji:"ğŸ˜"},

    { id:"giraffe", title:"Giraffe", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Giraffe_Mikumi_National_Park.jpg/500px-Giraffe_Mikumi_National_Park.jpg",
      kana:{hiragana:"ãã‚Šã‚“",katakana:"ã‚­ãƒªãƒ³"}, romaji:"kirin", emoji:"ğŸ¦’"},

    { id:"panda", title:"Giant panda", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Grosser_Panda.JPG/500px-Grosser_Panda.JPG",
      kana:{hiragana:"ã±ã‚“ã ",katakana:"ãƒ‘ãƒ³ãƒ€"}, romaji:"panda", emoji:"ğŸ¼"},

    { id:"dog", title:"Dog", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/YellowLabradorLooking_new.jpg/500px-YellowLabradorLooking_new.jpg",
      kana:{hiragana:"ã„ã¬",katakana:"ã‚¤ãƒŒ"}, romaji:"inu", emoji:"ğŸ¶"},

    { id:"cat", title:"Cat", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Cat_August_2010-4.jpg/500px-Cat_August_2010-4.jpg",
      kana:{hiragana:"ã­ã“",katakana:"ãƒã‚³"}, romaji:"neko", emoji:"ğŸ±"},

    { id:"rabbit", title:"Rabbit", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Oryctolagus_cuniculus_Rcdo.jpg/500px-Oryctolagus_cuniculus_Rcdo.jpg",
      kana:{hiragana:"ã†ã•ã",katakana:"ã‚¦ã‚µã‚®"}, romaji:"usagi", emoji:"ğŸ°"},

    { id:"bear", title:"Brown bear", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/2010-kodiak-bear-1.jpg/500px-2010-kodiak-bear-1.jpg",
      kana:{hiragana:"ãã¾",katakana:"ã‚¯ãƒ"}, romaji:"kuma", emoji:"ğŸ»"},

    { id:"wolf", title:"Wolf", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Kolmarden_wolf.jpg/500px-Kolmarden_wolf.jpg",
      kana:{hiragana:"ãŠãŠã‹ã¿",katakana:"ã‚ªã‚ªã‚«ãƒŸ"}, romaji:"ookami", emoji:"ğŸº"},

    { id:"fox", title:"Red fox", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Vulpes_vulpes_ssp_fulvus.jpg/500px-Vulpes_vulpes_ssp_fulvus.jpg",
      kana:{hiragana:"ãã¤ã­",katakana:"ã‚­ãƒ„ãƒ"}, romaji:"kitsune", emoji:"ğŸ¦Š"},

    { id:"deer", title:"Sika deer", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Sika_deer_%28Cervus_nippon%29_-_male_edit.jpg/500px-Sika_deer_%28Cervus_nippon%29_-_male_edit.jpg",
      kana:{hiragana:"ã—ã‹",katakana:"ã‚·ã‚«"}, romaji:"shika", emoji:"ğŸ¦Œ"},

    { id:"monkey", title:"Japanese macaque", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Macaca_fuscata_fuscata1.jpg/500px-Macaca_fuscata_fuscata1.jpg",
      kana:{hiragana:"ã•ã‚‹",katakana:"ã‚µãƒ«"}, romaji:"saru", emoji:"ğŸµ"},

    { id:"horse", title:"Horse", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Nokota_Horses_cropped.jpg/500px-Nokota_Horses_cropped.jpg",
      kana:{hiragana:"ã†ã¾",katakana:"ã‚¦ãƒ"}, romaji:"uma", emoji:"ğŸ´"},

    { id:"cow", title:"Cattle", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Cow_female_black_white.jpg/500px-Cow_female_black_white.jpg",
      kana:{hiragana:"ã†ã—",katakana:"ã‚¦ã‚·"}, romaji:"ushi", emoji:"ğŸ®"},

    { id:"pig", title:"Pig", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Sow_with_piglets_crosroads_farm.jpg/500px-Sow_with_piglets_crosroads_farm.jpg",
      kana:{hiragana:"ã¶ãŸ",katakana:"ãƒ–ã‚¿"}, romaji:"buta", emoji:"ğŸ·"},

    { id:"sheep", title:"Sheep", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Ovis_orientalis_aries_%27Skudde%27.jpg/500px-Ovis_orientalis_aries_%27Skudde%27.jpg",
      kana:{hiragana:"ã²ã¤ã˜",katakana:"ãƒ’ãƒ„ã‚¸"}, romaji:"hitsuji", emoji:"ğŸ‘"},

    { id:"goat", title:"Goat", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Domestic_goat_kid_in_capeweed.jpg/500px-Domestic_goat_kid_in_capeweed.jpg",
      kana:{hiragana:"ã‚„ã",katakana:"ãƒ¤ã‚®"}, romaji:"yagi", emoji:"ğŸ"},

    { id:"chicken", title:"Chicken", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/GallusGallus2.jpg/500px-GallusGallus2.jpg",
      kana:{hiragana:"ã«ã‚ã¨ã‚Š",katakana:"ãƒ‹ãƒ¯ãƒˆãƒª"}, romaji:"niwatori", emoji:"ğŸ”"},

    { id:"duck", title:"Duck", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Mallard2.jpg/500px-Mallard2.jpg",
      kana:{hiragana:"ã‚ã²ã‚‹",katakana:"ã‚¢ãƒ’ãƒ«"}, romaji:"ahiru", emoji:"ğŸ¦†"},

    { id:"penguin", title:"Emperor penguin", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/South_Shetland-2016-Deception_Island%E2%80%93Chinstrap_penguin_%28Pygoscelis_antarctica%29_04.jpg/500px-South_Shetland-2016-Deception_Island%E2%80%93Chinstrap_penguin_%28Pygoscelis_antarctica%29_04.jpg",
      kana:{hiragana:"ãºã‚“ãã‚“",katakana:"ãƒšãƒ³ã‚®ãƒ³"}, romaji:"pengin", emoji:"ğŸ§"},

    { id:"dolphin", title:"Dolphin", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Tursiops_truncatus_01.jpg/500px-Tursiops_truncatus_01.jpg",
      kana:{hiragana:"ã„ã‚‹ã‹",katakana:"ã‚¤ãƒ«ã‚«"}, romaji:"iruka", emoji:"ğŸ¬"},

    { id:"whale", title:"Humpback whale", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Humpback_whale_underwater_shot.jpg/500px-Humpback_whale_underwater_shot.jpg",
      kana:{hiragana:"ãã˜ã‚‰",katakana:"ã‚¯ã‚¸ãƒ©"}, romaji:"kujira", emoji:"ğŸ‹"},

    { id:"shark", title:"Great white shark", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/White_shark.jpg/500px-White_shark.jpg",
      kana:{hiragana:"ã•ã‚",katakana:"ã‚µãƒ¡"}, romaji:"same", emoji:"ğŸ¦ˆ"},

    { id:"octopus", title:"Octopus", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Octopus3.jpg/500px-Octopus3.jpg",
      kana:{hiragana:"ãŸã“",katakana:"ã‚¿ã‚³"}, romaji:"tako", emoji:"ğŸ™"},

    { id:"crab", title:"Crab", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Blue-crab-on-wet-surface.jpg/500px-Blue-crab-on-wet-surface.jpg",
      kana:{hiragana:"ã‹ã«",katakana:"ã‚«ãƒ‹"}, romaji:"kani", emoji:"ğŸ¦€"},

    { id:"frog", title:"Frog", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Frog_on_a_leaf.jpg/500px-Frog_on_a_leaf.jpg",
      kana:{hiragana:"ã‹ãˆã‚‹",katakana:"ã‚«ã‚¨ãƒ«"}, romaji:"kaeru", emoji:"ğŸ¸"},

    { id:"snake", title:"Snake", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Head_of_a_Rough-scaled_Bush_Viper.jpg/500px-Head_of_a_Rough-scaled_Bush_Viper.jpg",
      kana:{hiragana:"ã¸ã³",katakana:"ãƒ˜ãƒ“"}, romaji:"hebi", emoji:"ğŸ"},

    { id:"turtle", title:"Sea turtle", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Florida_box_turtle_digon3.jpg/500px-Florida_box_turtle_digon3.jpg",
      kana:{hiragana:"ã‹ã‚",katakana:"ã‚«ãƒ¡"}, romaji:"kame", emoji:"ğŸ¢"},

    { id:"kangaroo", title:"Kangaroo", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Kangaroo_and_joey03.jpg/500px-Kangaroo_and_joey03.jpg",
      kana:{hiragana:"ã‹ã‚“ãŒã‚‹ãƒ¼",katakana:"ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼"}, romaji:"kangaroo", emoji:"ğŸ¦˜"},

    { id:"koala", title:"Koala", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Koala_climbing_tree.jpg/500px-Koala_climbing_tree.jpg",
      kana:{hiragana:"ã“ã‚ã‚‰",katakana:"ã‚³ã‚¢ãƒ©"}, romaji:"koala", emoji:"ğŸ¨"},

    { id:"zebra", title:"Zebra", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Plains_Zebra_Equus_quagga.jpg/500px-Plains_Zebra_Equus_quagga.jpg",
      kana:{hiragana:"ã—ã¾ã†ã¾",katakana:"ã‚·ãƒã‚¦ãƒ"}, romaji:"shimauma", emoji:"ğŸ¦“"},

    { id:"hippopotamus", title:"Hippopotamus", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Hippo_at_the_Hluhluwe-Imfolozi_Game_Reserve.jpg/500px-Hippo_at_the_Hluhluwe-Imfolozi_Game_Reserve.jpg",
      kana:{hiragana:"ã‹ã°",katakana:"ã‚«ãƒ"}, romaji:"kaba", emoji:"ğŸ¦›"},

    { id:"rhinoceros", title:"Rhinoceros", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Rhinoceros_unicornis_-_Whipsnade.jpg/500px-Rhinoceros_unicornis_-_Whipsnade.jpg",
      kana:{hiragana:"ã•ã„",katakana:"ã‚µã‚¤"}, romaji:"sai", emoji:"ğŸ¦"},

    { id:"camel", title:"Camel", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Single_Humped_Camel.jpg/500px-Single_Humped_Camel.jpg",
      kana:{hiragana:"ã‚‰ãã ",katakana:"ãƒ©ã‚¯ãƒ€"}, romaji:"rakuda", emoji:"ğŸ«"},

    { id:"leopard", title:"Leopard", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Leopard_africa.jpg/500px-Leopard_africa.jpg",
      kana:{hiragana:"ã²ã‚‡ã†",katakana:"ãƒ’ãƒ§ã‚¦"}, romaji:"hyou", emoji:"ğŸ†"},

    { id:"cheetah", title:"Cheetah", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Cheetah_portrait.jpg/500px-Cheetah_portrait.jpg",
      kana:{hiragana:"ã¡ãƒ¼ãŸãƒ¼",katakana:"ãƒãƒ¼ã‚¿ãƒ¼"}, romaji:"cheetah", emoji:"ğŸ†"},

    { id:"owl", title:"Owl", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Tawny-owl.jpg/500px-Tawny-owl.jpg",
      kana:{hiragana:"ãµãã‚ã†",katakana:"ãƒ•ã‚¯ãƒ­ã‚¦"}, romaji:"fukurou", emoji:"ğŸ¦‰"},

    { id:"parrot", title:"Parrot", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/Ara_macao_-on_a_stick.jpg/500px-Ara_macao_-on_a_stick.jpg",
      kana:{hiragana:"ãŠã†ã‚€",katakana:"ã‚ªã‚¦ãƒ "}, romaji:"oumu", emoji:"ğŸ¦œ"},

    { id:"eagle", title:"Golden eagle", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Bald_Eagle_Portrait.jpg/500px-Bald_Eagle_Portrait.jpg",
      kana:{hiragana:"ã‚ã—",katakana:"ãƒ¯ã‚·"}, romaji:"washi", emoji:"ğŸ¦…"},

    { id:"bat", title:"Bat", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Big_Brown_Bat_%28Eptesicus_fuscus%29.jpg/500px-Big_Brown_Bat_%28Eptesicus_fuscus%29.jpg",
      kana:{hiragana:"ã“ã†ã‚‚ã‚Š",katakana:"ã‚³ã‚¦ãƒ¢ãƒª"}, romaji:"koumori", emoji:"ğŸ¦‡"},

    { id:"hedgehog", title:"Hedgehog", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Erinaceus_europaeus_LC0119.jpg/500px-Erinaceus_europaeus_LC0119.jpg",
      kana:{hiragana:"ã¯ã‚Šã­ãšã¿",katakana:"ãƒãƒªãƒã‚ºãƒŸ"}, romaji:"harinezumi", emoji:"ğŸ¦”"},

    { id:"squirrel", title:"Squirrel", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Red_squirrel_%28Sciurus_vulgaris%29_in_Ystad_2015.jpg/500px-Red_squirrel_%28Sciurus_vulgaris%29_in_Ystad_2015.jpg",
      kana:{hiragana:"ã‚Šã™",katakana:"ãƒªã‚¹"}, romaji:"risu", emoji:"ğŸ¿ï¸"},

    { id:"mouse", title:"House mouse", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/House_mouse_02.jpg/500px-House_mouse_02.jpg",
      kana:{hiragana:"ã­ãšã¿",katakana:"ãƒã‚ºãƒŸ"}, romaji:"nezumi", emoji:"ğŸ­"},

    { id:"ant", title:"Ant", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Pogonomyrmex_badius.jpg/500px-Pogonomyrmex_badius.jpg",
      kana:{hiragana:"ã‚ã‚Š",katakana:"ã‚¢ãƒª"}, romaji:"ari", emoji:"ğŸœ"},

    { id:"bee", title:"Honey bee", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Western_honey_bee_extracts_nectar.jpg/500px-Western_honey_bee_extracts_nectar.jpg",
      kana:{hiragana:"ã¿ã¤ã°ã¡",katakana:"ãƒŸãƒ„ãƒãƒ"}, romaji:"mitsubachi", emoji:"ğŸ"},

    { id:"butterfly", title:"Butterfly", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Cattleheart_Butterfly_%28Parides_arcas%29.jpg/500px-Cattleheart_Butterfly_%28Parides_arcas%29.jpg",
      kana:{hiragana:"ã¡ã‚‡ã†",katakana:"ãƒãƒ§ã‚¦"}, romaji:"chou", emoji:"ğŸ¦‹"},

    { id:"ladybug", title:"Coccinellidae", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Coccinella_magnifica01.jpg/500px-Coccinella_magnifica01.jpg",
      kana:{hiragana:"ã¦ã‚“ã¨ã†ã‚€ã—",katakana:"ãƒ†ãƒ³ãƒˆã‚¦ãƒ ã‚·"}, romaji:"tentoumushi", emoji:"ğŸ"},

    { id:"crocodile", title:"Crocodile", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Nile_crocodile_head.jpg/500px-Nile_crocodile_head.jpg",
      kana:{hiragana:"ã‚ã«",katakana:"ãƒ¯ãƒ‹"}, romaji:"wani", emoji:"ğŸŠ"},

    { id:"seal", title:"Seal", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Leopard_seal_2.jpg/500px-Leopard_seal_2.jpg",
      kana:{hiragana:"ã‚ã–ã‚‰ã—",katakana:"ã‚¢ã‚¶ãƒ©ã‚·"}, romaji:"azarashi", emoji:"ğŸ¦­"},

    { id:"otter", title:"Otter", topicId:"animals",
      image:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Otter_%28Lutra_lutra%29.jpg/500px-Otter_%28Lutra_lutra%29.jpg",
      kana:{hiragana:"ã‹ã‚ã†ã",katakana:"ã‚«ãƒ¯ã‚¦ã‚½"}, romaji:"kawauso", emoji:"ğŸ¦¦"},
  ]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE & SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let settings = {
  script: 'hiragana',
  topicId: 'shinkansen',
  autoSpeak: false
};

let cards = [];
let currentIndex = 0;
let isFlipped = false;
let swipeHintShown = false;

// â”€â”€ Load from localStorage â”€â”€
function loadSettings() {
  try {
    const saved = JSON.parse(localStorage.getItem('jpFlashSettings') || '{}');
    settings = { ...settings, ...saved };
  } catch(e) {}
}

function saveSettings() {
  try {
    localStorage.setItem('jpFlashSettings', JSON.stringify(settings));
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FISHER-YATES SHUFFLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM REFS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const homePage = document.getElementById('home-page');
const flashPage = document.getElementById('flash-page');
const cardScene = document.getElementById('card-scene');
const cardInner = document.getElementById('card-inner');
const cardImg = document.getElementById('card-img');
const cardImgFallback = document.getElementById('card-img-fallback');
const cardRomaji = document.getElementById('card-romaji');
const kanaDisplay = document.getElementById('kana-display');
const kanaRomajiBack = document.getElementById('kana-romaji-back');
const progressText = document.getElementById('progress-text');
const progressBar = document.getElementById('progress-bar');
const soundBtn = document.getElementById('sound-btn');
const completeScreen = document.getElementById('complete-screen');
const swipeHint = document.getElementById('swipe-hint');
const autospeakIndicator = document.getElementById('autospeak-indicator');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME PAGE LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyHomepageSettings() {
  // Script buttons
  document.querySelectorAll('.script-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.script === settings.script);
  });
  // Topic buttons
  document.querySelectorAll('.topic-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.topic === settings.topicId);
  });
  // Auto speak
  document.getElementById('auto-speak-toggle').checked = settings.autoSpeak;
}

document.querySelectorAll('.script-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    settings.script = btn.dataset.script;
    document.querySelectorAll('.script-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    saveSettings();
  });
});

document.querySelectorAll('.topic-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    settings.topicId = btn.dataset.topic;
    document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    saveSettings();
  });
});

document.getElementById('auto-speak-toggle').addEventListener('change', (e) => {
  settings.autoSpeak = e.target.checked;
  saveSettings();
});

document.getElementById('start-btn').addEventListener('click', () => {
  saveSettings();
  startFlashcards();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startFlashcards() {
  // Filter + shuffle
  const filtered = DATA.cards.filter(c => c.topicId === settings.topicId);
  cards = shuffle(filtered);
  currentIndex = 0;
  isFlipped = false;
  swipeHintShown = false;

  // Transition
  homePage.classList.add('slide-out');
  flashPage.classList.remove('hidden');

  renderCard('right');
  updateProgress();

  // Show swipe hint briefly
  swipeHint.classList.remove('faded');
  setTimeout(() => { swipeHint.classList.add('faded'); }, 3000);
}

function goHome() {
  flashPage.classList.add('hidden');
  homePage.classList.remove('slide-out');
  completeScreen.classList.remove('visible');
  cancelSpeech();
}

document.getElementById('back-btn').addEventListener('click', goHome);
document.getElementById('home-from-complete-btn').addEventListener('click', goHome);

document.getElementById('restart-btn').addEventListener('click', () => {
  completeScreen.classList.remove('visible');
  cards = shuffle(cards);
  currentIndex = 0;
  isFlipped = false;
  renderCard('right');
  updateProgress();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIT FRONT KANA TEXT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fitFrontKana() {
  const maxSize = 28;
  const minSize = 14;
  const padding = 40; // horizontal padding
  cardRomaji.style.fontSize = maxSize + 'px';
  const available = cardRomaji.parentElement.offsetWidth - padding;
  if (available <= 0) return;
  const textWidth = cardRomaji.scrollWidth;
  if (textWidth > available) {
    const ratio = available / textWidth;
    const fitted = Math.max(minSize, Math.floor(maxSize * ratio));
    cardRomaji.style.fontSize = fitted + 'px';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIT KANA TEXT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fitKanaText() {
  const maxSize = 88;
  const minSize = 28;
  const padding = 32; // total horizontal padding inside card
  kanaDisplay.style.fontSize = maxSize + 'px';
  const available = kanaDisplay.parentElement.offsetWidth - padding;
  if (available <= 0) return;
  const textWidth = kanaDisplay.scrollWidth;
  if (textWidth > available) {
    const ratio = available / textWidth;
    const fitted = Math.max(minSize, Math.floor(maxSize * ratio));
    kanaDisplay.style.fontSize = fitted + 'px';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCard(dir = 'right') {
  const card = cards[currentIndex];
  if (!card) return;

  // Reset flip
  isFlipped = false;
  cardInner.classList.remove('flipped');

  // Image with fallback to emoji
  cardImgFallback.textContent = card.emoji;
  cardImg.classList.add('loading');
  cardImg.classList.remove('error');
  cardImg.alt = card.romaji;
  cardImg.onload = () => cardImg.classList.remove('loading');
  cardImg.onerror = () => { cardImg.classList.remove('loading'); cardImg.classList.add('error'); };
  cardImg.src = card.image;
  
  // Show kana on front (not romaji)
  const kana = card.kana[settings.script];
  cardRomaji.textContent = kana;
  requestAnimationFrame(fitFrontKana);

  // Kana on back
  kanaDisplay.textContent = kana;
  kanaRomajiBack.textContent = card.romaji;
  requestAnimationFrame(fitKanaText);

  // Animation
  cardScene.classList.remove('anim-right', 'anim-left');
  void cardScene.offsetWidth; // reflow
  cardScene.classList.add(dir === 'right' ? 'anim-right' : 'anim-left');
  setTimeout(() => cardScene.classList.remove('anim-right', 'anim-left'), 400);

  updateProgress();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateProgress() {
  const total = cards.length;
  const current = currentIndex + 1;
  progressText.textContent = `${current} / ${total}`;
  progressBar.style.width = `${(current / total) * 100}%`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLIP CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function flipCard() {
  isFlipped = !isFlipped;
  cardInner.classList.toggle('flipped', isFlipped);

  if (isFlipped && settings.autoSpeak) {
    setTimeout(() => {
      speak(cards[currentIndex].kana[settings.script]);
      showAutospeakIndicator();
    }, 300);
  }
}

cardScene.addEventListener('click', (e) => {
  if (e.target === soundBtn || soundBtn.contains(e.target)) return;
  flipCard();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION (NEXT / PREV)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nextCard() {
  if (currentIndex >= cards.length - 1) {
    showComplete();
    return;
  }
  currentIndex++;
  renderCard('right');
  cancelSpeech();
}

function prevCard() {
  if (currentIndex <= 0) return;
  currentIndex--;
  renderCard('left');
  cancelSpeech();
}

function showComplete() {
  completeScreen.classList.add('visible');
}

// Shuffle button
document.getElementById('shuffle-btn').addEventListener('click', () => {
  cards = shuffle(cards);
  currentIndex = 0;
  isFlipped = false;
  renderCard('right');
  buildDots();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SWIPE / DRAG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let touchStartX = 0;
let touchStartY = 0;
let isDragging = false;
let dragX = 0;
const SWIPE_THRESHOLD = 60;

cardScene.addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  isDragging = false;
  dragX = 0;
}, { passive: true });

cardScene.addEventListener('touchmove', (e) => {
  const dx = e.touches[0].clientX - touchStartX;
  const dy = e.touches[0].clientY - touchStartY;
  if (!isDragging && Math.abs(dx) > 8 && Math.abs(dy) < 30) {
    isDragging = true;
    cardScene.classList.add('dragging');
  }
  if (isDragging) {
    dragX = dx;
    cardInner.style.transform = isFlipped
      ? `rotateY(180deg) translateX(${-dragX * 0.5}px) rotate(${-dragX * 0.02}deg)`
      : `translateX(${dragX * 0.4}px) rotate(${dragX * 0.015}deg)`;
    e.preventDefault();
  }
}, { passive: false });

cardScene.addEventListener('touchend', () => {
  cardScene.classList.remove('dragging');
  cardInner.style.transform = '';

  if (isDragging) {
    if (dragX < -SWIPE_THRESHOLD) nextCard();
    else if (dragX > SWIPE_THRESHOLD) prevCard();
    isDragging = false;
    dragX = 0;
    return;
  }
});

// Mouse drag (desktop)
let mouseDown = false;
let mouseStartX = 0;

cardScene.addEventListener('mousedown', (e) => {
  mouseDown = true;
  mouseStartX = e.clientX;
  isDragging = false;
  dragX = 0;
});

window.addEventListener('mousemove', (e) => {
  if (!mouseDown) return;
  const dx = e.clientX - mouseStartX;
  if (!isDragging && Math.abs(dx) > 10) {
    isDragging = true;
    cardScene.classList.add('dragging');
  }
  if (isDragging) {
    dragX = dx;
    cardInner.style.transform = isFlipped
      ? `rotateY(180deg) translateX(${-dragX * 0.5}px) rotate(${-dragX * 0.02}deg)`
      : `translateX(${dragX * 0.4}px) rotate(${dragX * 0.015}deg)`;
  }
});

window.addEventListener('mouseup', () => {
  if (!mouseDown) return;
  mouseDown = false;
  cardScene.classList.remove('dragging');
  cardInner.style.transform = '';

  if (isDragging) {
    if (dragX < -SWIPE_THRESHOLD) nextCard();
    else if (dragX > SWIPE_THRESHOLD) prevCard();
  }
  isDragging = false;
  dragX = 0;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KEYBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', (e) => {
  if (flashPage.classList.contains('hidden')) return;
  if (e.key === 'ArrowRight') nextCard();
  else if (e.key === 'ArrowLeft') prevCard();
  else if (e.key === ' ' || e.key === 'Enter') flipCard();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPEECH SYNTHESIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUtterance = null;

function speak(text) {
  if (!('speechSynthesis' in window)) return;
  cancelSpeech();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'ja-JP';
  utter.rate = 0.85;
  utter.pitch = 1.0;
  currentUtterance = utter;

  soundBtn.classList.add('playing');
  utter.onend = () => {
    soundBtn.classList.remove('playing');
    currentUtterance = null;
  };
  utter.onerror = () => {
    soundBtn.classList.remove('playing');
    currentUtterance = null;
  };
  speechSynthesis.speak(utter);
}

function cancelSpeech() {
  if ('speechSynthesis' in window) speechSynthesis.cancel();
  soundBtn.classList.remove('playing');
  currentUtterance = null;
}

soundBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  const kana = cards[currentIndex]?.kana[settings.script];
  if (kana) speak(kana);
});

function showAutospeakIndicator() {
  autospeakIndicator.classList.add('show');
  setTimeout(() => autospeakIndicator.classList.remove('show'), 1500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadSettings();
applyHomepageSettings();
</script>
</body>
</html>